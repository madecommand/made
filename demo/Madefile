
>strict:
  set -eux
  ${TASK}

>each: ARG
  for CURRENT in ${ARG} ; do
    ${TASK}
  done

>notify:
  ${TASK}
  mail root <<-EOF
  Subject: App ${PWD##*/} deployment: $STATUS
  
  This is an automated message to inform you that there was an attempt to deploy
  EOF

>print:
  echo ${TASK_STRING}

>run:
  exec ${TASK_FILE}

>tempfile:
  TEMPFILE=`mktemp`
  ${TASK}
  rm $TEMPFILE



>ssh:
^each $1
  scp $SCRIPT $1:/tmp

  




>ssh:
  for host in $1; do
    scp $SCRIPT $host:/tmp/made-ssh
    ssh -t -i $host /tmp/made-ssh
    ssh $host rm /tmp/made-ssh
    echo $SCRIPT | ssh -t -i host /bin/sh
  done

>docker: 
  docker run $1

staging:
  ENV=staging
  HOSTS=staging.example.com

production:
  ENV=production
  HOSTS=app1.example.com app2.example.com

deploy: # Deploys app 
^ssh $HOSTS
  cd /app
  git pull
  
test:
^docker app
  ./bin/test

build:
  docker build . -t app





  
